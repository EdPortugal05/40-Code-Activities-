using System;
using System.Collections.Generic;
using System.Globalization;
using System.Linq;
using System.Text;
using System.Text.RegularExpressions;

class TextCleaner
{
    private static readonly string[] StopWords = { "the", "and", "a", "an", "in", "on", "at", "to", "for", "of" };

    public static string CleanText(string input)
    {
        if (string.IsNullOrWhiteSpace(input))
            return string.Empty;

        // Normalize whitespace and trim
        string cleaned = Regex.Replace(input.Trim(), @"\s+", " ");

        // Remove non-printable characters except basic punctuation
        cleaned = Regex.Replace(cleaned, @"[^\u0020-\u007E]", string.Empty);

        // Convert to title case
        TextInfo textInfo = CultureInfo.CurrentCulture.TextInfo;
        cleaned = textInfo.ToTitleCase(cleaned.ToLower());

        // Fix small words in title case
        cleaned = Regex.Replace(cleaned, @"\b(A|An|The|And|But|Or|For|Nor|With|On|At|To|From|By)\b", 
            match => match.Value.ToLower(), RegexOptions.IgnoreCase);

        return cleaned;
    }

    public static TextStats AnalyzeText(string text)
    {
        var stats = new TextStats();

        if (string.IsNullOrWhiteSpace(text))
            return stats;

        // Word count
        var words = Regex.Matches(text, @"\b[\w']+\b")
                        .Select(m => m.Value)
                        .ToList();
        stats.WordCount = words.Count;

        // Sentence count (naive approach)
        stats.SentenceCount = Regex.Matches(text, @"[^\.!?]*[\.!?]").Count;

        // Top 5 words (excluding stop words)
        stats.TopWords = words
            .Where(w => !StopWords.Contains(w.ToLower()))
            .GroupBy(w => w.ToLower())
            .OrderByDescending(g => g.Count())
            .Take(5)
            .Select(g => g.Key)
            .ToList();

        return stats;
    }
}

class TextStats
{
    public int WordCount { get; set; }
    public int SentenceCount { get; set; }
    public List<string> TopWords { get; set; } = new List<string>();
}

class Program
{
    static void Main()
    {
        Console.WriteLine("TEXT REPORT CLEANER");
        Console.WriteLine("Enter your text (press Enter twice to finish):");
        
        StringBuilder input = new StringBuilder();
        string line;
        while (!string.IsNullOrWhiteSpace(line = Console.ReadLine()))
        {
            input.AppendLine(line);
        }

        string cleanedText = TextCleaner.CleanText(input.ToString());
        TextStats stats = TextCleaner.AnalyzeText(cleanedText);

        Console.WriteLine("\nCLEANED TEXT:");
        Console.WriteLine(cleanedText);

        Console.WriteLine("\nTEXT STATISTICS:");
        Console.WriteLine($"Word count: {stats.WordCount}");
        Console.WriteLine($"Sentence count: {stats.SentenceCount}");
        Console.WriteLine($"Top 5 words: {string.Join(", ", stats.TopWords)}");
    }
}
